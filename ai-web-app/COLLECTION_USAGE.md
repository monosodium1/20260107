# 采集管理功能使用说明

## 功能概述

采集管理模块提供了实时数据采集、展示和保存的完整功能，用户可以通过关键词定向采集数据，并实时查看采集结果。

## 主要功能

### 1. 关键字输入
- 支持输入任意搜索关键词
- 一键开始/停止采集
- 实时状态反馈

### 2. 爬虫源选择
- 开关模式切换选择
- 显示所有活跃的爬虫源
- 支持多选
- 视觉反馈（选中状态高亮）

### 3. 橱窗列表展示
- 卡片式布局展示采集数据
- 封面图片（有则显示，无则显示默认图）
- 标题（点击可跳转到原网页）
- 采集时间
- 来源信息

### 4. 实时数据渲染
- 采集过程中数据即时显示
- 淡入动画效果
- 自动滚动到最新数据
- 数据计数实时更新

### 5. 数据选择和保存
- 单选/多选数据
- 全选/取消全选
- 批量保存到数据库
- 保存成功提示

## 使用步骤

### 第一步：创建爬虫源
1. 访问"爬虫管理"页面
2. 点击"新增源"
3. 填写源信息并保存

### 第二步：开始采集
1. 访问"采集管理"页面
2. 在关键字输入框中输入搜索关键词（如"林俊杰"）
3. 在爬虫源选择区域选择要使用的爬虫源
4. 点击"开始采集"按钮

### 第三步：查看采集数据
1. 数据会实时显示在橱窗列表中
2. 每个数据卡片显示：
   - 封面图片
   - 标题（可点击跳转）
   - 采集时间
   - 来源信息
3. 页面会自动滚动到最新数据

### 第四步：选择和保存数据
1. 点击数据卡片选中/取消选中
2. 使用"全选"或"取消全选"快速操作
3. 点击"保存选中"按钮将数据保存到数据库

## 页面布局

从上到下依次排列：

1. **关键字输入区域**
   - 输入框
   - 开始采集按钮
   - 停止采集按钮（采集时显示）

2. **爬虫源选择面板**
   - 网格布局显示所有爬虫源
   - 每个源显示名称和类型
   - 开关模式选择

3. **橱窗数据列表**
   - 操作按钮区（全选、取消全选、保存选中）
   - 采集状态提示
   - 数据卡片网格
   - 滚动到底部按钮

## 技术特性

### 实时通信
- 使用Server-Sent Events (SSE)实现实时数据推送
- 无需轮询，高效节能
- 自动重连机制

### 响应式设计
- 适配PC、平板、手机
- 自适应网格布局
- 触摸友好的交互

### 数据处理
- 异步采集，不阻塞主线程
- 错误处理和重试机制
- 数据验证和清洗

### 用户体验
- 流畅的动画效果
- 清晰的状态反馈
- 直观的操作界面

## API接口

### 获取爬虫源列表
```
GET /api/collection/sources
```

### 开始采集
```
POST /api/collection/start
参数:
- keyword: 搜索关键词
- source_ids: 爬虫源ID数组（JSON字符串）
- page: 起始页（默认1）
- pages: 总页数（默认1）
- limit: 每页数量（默认10）

返回:
{
  "collection_id": "collection_xxx"
}
```

### 实时数据流
```
GET /api/collection/stream?collection_id=xxx
返回: SSE流，每条数据格式:
data: {...}
```

### 保存数据
```
POST /api/collection/save
参数:
- data: 数据项数组（JSON字符串）

返回:
{
  "saved_count": 5
}
```

### 停止采集
```
POST /api/collection/stop
参数:
- collection_id: 采集任务ID

返回:
{
  "success": true,
  "message": "采集已停止"
}
```

## 数据模型

### CollectionData
```python
{
    'id': 数据ID,
    'title': 标题,
    'url': URL,
    'summary': 摘要,
    'source': 来源网站,
    'image_url': 封面图片URL,
    'keyword': 搜索关键词,
    'source_type': 爬虫源类型,
    'raw_data': 原始数据（JSON）,
    'collected_at': 采集时间,
    'saved_at': 保存时间
}
```

## 注意事项

1. **网络连接**：确保服务器可以访问目标搜索引擎
2. **频率限制**：避免过于频繁的请求
3. **数据验证**：保存前检查数据完整性
4. **浏览器兼容**：建议使用现代浏览器（Chrome、Firefox、Edge等）
5. **存储空间**：大量采集数据会占用数据库空间

## 扩展功能

未来可以添加的功能：
- 数据导出（Excel、CSV）
- 数据过滤和搜索
- 数据分类管理
- 采集历史记录
- 定时采集任务
- 数据统计分析

## 故障排查

### 采集没有数据
- 检查网络连接
- 确认爬虫源是否正常
- 尝试更换关键词

### 数据显示异常
- 刷新页面
- 检查浏览器控制台错误
- 清除浏览器缓存

### 保存失败
- 检查数据库连接
- 确认数据格式正确
- 查看服务器日志

## 系统状态

当前系统运行在：http://localhost:5000

访问采集管理页面：http://localhost:5000/collection

登录凭据：
- 用户名：admin
- 密码：123456
